<template name="StatusMain">
  <div class="status-main row">
    <div class="col l6">
      <h3>Data Fetchers</h3>
      <table>
        <thead>
          <tr>
            <th class="health">Health</th>
            <th>Module / View</th>
            <th>Warn since</th>
            <th>Interval</th>
          </tr>
        </thead>

        <tbody>
          {{#each views}}
            <tr class="expanded-{{viewIsExpanded}}">
              <td class="health">
                <a href="#toggle">
                  {{#with viewIcon}}
                    <i class="material-icons" style="color: {{color}};" title={{title}}>{{icon}}</i>
                  {{/with}}
                  <i class="material-icons" style="color: #90a4ae;">{{viewCollapser}}</i>
                </a>
              </td>
              <td>
                {{#with viewModule}}
                  <a href="/modules/{{_id}}">{{name}}</a>
                {{/with}}
                /
                <a href="/modules/{{module}}/views/{{_id}}#screens">{{name}}</a>
              </td>
              <td>
                {{#with firstFailure}}
                  {{fromNow since}}
                {{/with}}
              </td>
              <td>{{interval}}</td>
            </tr>

            {{#if viewIsExpanded}}

              {{#each viewScreens}}
                <tr>
                  <td class="health">
                    {{#with screenIcon}}
                      <i class="material-icons" style="color: {{color}};">{{icon}}</i>
                    {{/with}}
                    <a href="#refresh-screen">
                      <i class="material-icons">refresh</i>
                    </a>
                  </td>
                  <td>
                    <div>{{name}}</div>
                    {{#with failure}}
                      <div>{{message}}</div>
                    {{/with}}
                  </td>
                  <td colspan="2">
                    <div>Next sync {{fromNow expires}}</div>
                  </td>
                </tr>
              {{else}}
                <tr class="noconfig">
                  <td colspan="4">
                    <em>no screens configured</em>
                  </td>
                </tr>
              {{/each}}

              <!--
              {{#with firstFailure}}
                <tr>
                  <td colspan="4">
                    <p style="margin-top: 0;">
                      First failure: {{message}}
                    </p>
                    <p>
                      <code class="stack">{{details}}</code>
                    </p>
                  </td>
                </tr>
              {{/with}}
              -->
              <tr><td colspan="4"></td></tr>
            {{/if}}
          {{/each}}
        </tbody>
      </table>
    </div>
    <div class="col l6">
      <h3>Display Devices</h3>
      <table>
        <thead>
          <tr>
            <th class="health">Health</th>
            <th>Code</th>
            <th>Display</th>
            <th>Last seen</th>
          </tr>
        </thead>

        <tbody>
          {{#with unpaired.count}}
            <tr class="unpaired">
              <td class="health">
                <i class="material-icons" style="color: #ffc107;">timelapse</i>
              </td>
              <td colspan="3">
                <em>{{this}} unpaired devices online</em>
              </td>
            </tr>
          {{/with}}
          {{#each displays}}
            <tr>
              <td class="health">
                {{#with displayIcon}}
                  <i class="material-icons" style="color: {{color}};">{{icon}}</i>
                {{/with}}
              </td>
              <td>{{_id.toUpperCase}}</td>
              <td>
                {{#if token}}
                  {{name}}
                {{else}}
                  <em>(unpaired)</em>
                {{/if}}
              </td>
              <td>{{fromNow lastSeen}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</template>
